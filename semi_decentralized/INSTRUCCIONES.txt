================================================================================
    GUÃA RÃPIDA: Sistema Semi-Descentralizado con Agregador Rotativo
================================================================================

DESCRIPCIÃ“N:
-----------
Sistema donde todos los nodos inician iguales, la DB elige uno como agregador
(basado en valor random 1-100), y el agregador rota en cada ronda.

LA BASE DE DATOS ESTÃ EN TU PC (no en las Raspberry Pis)


PASO 1: CONFIGURAR JSON
========================

OPCIÃ“N A: ConfiguraciÃ³n AutomÃ¡tica (Recomendada)
-------------------------------------------------
./configurar_ip.sh

Este script detecta la IP de tu PC y actualiza los JSON automÃ¡ticamente.


OPCIÃ“N B: ConfiguraciÃ³n Manual
-------------------------------
Solo editar estos 2 archivos:

1. setups/config_db.json
   -------------------------
   {
     "db_ip": "192.168.1.50",      â† CAMBIAR a la IP de TU PC
     "db_socket": "9017",
     "db_name": "sample_data",
     "db_data_path": "./db",
     "db_model_path": "./db/models"
   }

   Para obtener la IP de tu PC:
   - Linux: ip addr | grep inet
   - Windows: ipconfig
   - Mac: ifconfig | grep inet

2. setups/config_aggregator.json
   -------------------------
   {
     "db_ip": "192.168.1.50",                â† MISMA IP de tu PC
     "agent_registration_threshold": 4,      â† NÃºmero de Raspberry Pis
     "semi_decentralized": true,             â† DEBE ser true
     "enable_aggregator_rotation": true,     â† DEBE ser true
     ...resto OK por defecto...
   }

NOTA: Los JSON son IGUALES en tu PC y en las 4 Raspberry Pis


PASO 2: INICIAR BASE DE DATOS (SOLO EN TU PC)
==============================================

En tu PC:
---------
cd /ruta/al/proyecto/semi_decentralized
python3 -m fl_main.init_db

Salida esperada:
  âœ… --- Database initialized successfully ---

IMPORTANTE: Dejar la DB corriendo en tu PC durante todo el proceso


PASO 3: COPIAR PROYECTO A RASPBERRY PIS (sin DB)
=================================================

En tu PC:
---------
cd /ruta/al/proyecto
tar -czf semi_decentralized.tar.gz semi_decentralized/
scp semi_decentralized.tar.gz pi@192.168.1.101:~/
scp semi_decentralized.tar.gz pi@192.168.1.102:~/
scp semi_decentralized.tar.gz pi@192.168.1.103:~/
scp semi_decentralized.tar.gz pi@192.168.1.104:~/

En cada Raspberry Pi:
---------------------
ssh pi@<IP_PI>
cd ~
tar -xzf semi_decentralized.tar.gz
cd semi_decentralized
pip3 install websockets numpy torch torchvision


PASO 4: INICIAR NODOS (EN CADA RASPBERRY PI)
=============================================

Las Raspberry Pis se conectarÃ¡n a la DB en tu PC automÃ¡ticamente.

Raspberry Pi 1:
---------------
ssh pi@192.168.1.101
cd ~/semi_decentralized
python3 -m fl_main.unified_node pi1 50001 4

Raspberry Pi 2:
---------------
ssh pi@192.168.1.102
cd ~/semi_decentralized
python3 -m fl_main.unified_node pi2 50002 4

Raspberry Pi 3:
---------------
ssh pi@192.168.1.103
cd ~/semi_decentralized
python3 -m fl_main.unified_node pi3 50003 4

Raspberry Pi 4:
---------------
ssh pi@192.168.1.104
cd ~/semi_decentralized
python3 -m fl_main.unified_node pi4 50004 4

Argumentos:
  - pi1, pi2, etc: Nombre Ãºnico del nodo
  - 50001, 50002, etc: Puerto para ese nodo
  - 4: Threshold (nÃºmero de nodos antes de seleccionar agregador)


QUÃ‰ ESPERAR EN LOS LOGS:
=========================

Todos los nodos mostrarÃ¡n:
  --- Registering node 'piX' with DB ---
  --- Node registered with random value: XX ---
  --- Currently X/4 agents registered ---
  --- Threshold reached! ---

UN nodo mostrarÃ¡:
  ğŸ¯ --- THIS NODE SELECTED AS AGGREGATOR for round 0 ---

Los otros TRES mostrarÃ¡n:
  ğŸ‘¤ --- This node will act as AGENT (Aggregator: piX) ---


CÃ“MO DETENER EL SISTEMA:
=========================

En cada terminal: Ctrl+C

O desde cualquier Pi:
  pkill -f unified_node


REINICIAR LIMPIO:
=================

En tu PC:
  cd ~/ruta/al/proyecto/semi_decentralized
  pkill -f unified_node  (si tienes nodos corriendo en tu PC tambiÃ©n)
  rm db/sample_data.db
  python3 -m fl_main.init_db

En cada Raspberry Pi:
  pkill -f unified_node

Luego reiniciar:
  1. DB en tu PC (si no estÃ¡ corriendo)
  2. Los 4 nodos en las Raspberry Pis (Paso 4)


VERIFICAR CONFIGURACIÃ“N:
=========================

Antes de copiar a las Pis, verificar:
  python3 check_config.py

Debe mostrar: âœ… All checks passed!


CONSULTAR BASE DE DATOS (desde tu PC):
=======================================

En tu PC:
  cd ~/ruta/al/proyecto/semi_decentralized
  sqlite3 db/sample_data.db
  
  SELECT * FROM registered_agents;
  SELECT * FROM current_aggregator WHERE status='active';
  
  .quit


ARQUITECTURA DEL SISTEMA:
==========================

         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   TU PC     â”‚
         â”‚   (DB)      â”‚
         â”‚ 192.168.1.50â”‚
         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           â”‚           â”‚           â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”
â”‚ Pi 1  â”‚   â”‚ Pi 2  â”‚   â”‚ Pi 3  â”‚   â”‚ Pi 4  â”‚
â”‚(Nodo) â”‚   â”‚(Nodo) â”‚   â”‚(Nodo) â”‚   â”‚(Nodo) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”˜

1. Tu PC hospeda la DB (centralizada)
2. Las 4 Raspberry Pis se conectan a tu PC
3. DB en tu PC selecciona cuÃ¡l Pi serÃ¡ agregador
4. Las otras 3 Pis se conectan a la Pi agregadora
5. DespuÃ©s de cada ronda, DB elige nuevo agregador


SOLUCIÃ“N DE PROBLEMAS:
======================

"Database locked":
  En tu PC:
    cd ~/ruta/al/proyecto/semi_decentralized
    rm db/sample_data.db
    python3 -m fl_main.init_db

"Raspberry Pis no se conectan a la DB":
  - Verificar que db_ip en config_db.json es la IP de tu PC
  - En tu PC: ip addr | grep inet (para obtener tu IP)
  - Hacer ping desde las Raspberry Pis a tu PC: ping 192.168.1.50
  - Verificar firewall de tu PC permite conexiones en puerto 9017
  - En Linux: sudo ufw allow 9017
  - En tu PC, asegurar que la DB estÃ¡ corriendo

"No se selecciona agregador":
  - Verificar que las 4 Raspberry Pis estÃ©n ejecutando
  - Ver logs: debe mostrar "4/4 agents registered"


RESUMEN DE ARCHIVOS IMPORTANTES:
=================================

fl_main/unified_node.py       â†’ Punto de entrada (todos los nodos)
fl_main/init_db.py            â†’ Inicializar base de datos
fl_main/pseudodb/sqlite_db.py â†’ Funciones de DB y selecciÃ³n de agregador
check_config.py               â†’ Verificar configuraciÃ³n
setups/config_db.json         â†’ Config de base de datos
setups/config_aggregator.json â†’ Config de agregador
setups/config_agent.json      â†’ Config de agentes


FLUJO COMPLETO:
===============

1. Tu PC: Inicializar DB
2. Copiar proyecto a las 4 Raspberry Pis (con JSON configurado)
3. Iniciar nodos en las 4 Raspberry Pis
4. Nodos se registran en DB (en tu PC) con valores random 1-100
5. DB (en tu PC) selecciona agregador (mayor valor random)
6. Nodo elegido â†’ inicia como agregador
7. Otros nodos â†’ consultan DB, conectan al agregador como agentes
8. Ronda FL: entrenar â†’ enviar â†’ agregar â†’ distribuir
9. DB reasigna nuevos valores random
10. Nueva selecciÃ³n de agregador
11. REPETIR desde paso 6

IMPORTANTE: La DB siempre estÃ¡ en tu PC, NUNCA en las Raspberry Pis


FIN
================================================================================
